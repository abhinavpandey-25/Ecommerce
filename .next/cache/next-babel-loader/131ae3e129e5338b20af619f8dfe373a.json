{"ast":null,"code":"import jwt from 'jsonwebtoken';\nimport Cart from '../../models/Cart';\nimport Authenticated from '../../helper/Authenticated';\nimport initDb from '../../helper/initDb';\ninitDb();\nexport default (async (req, res) => {\n  switch (req.method) {\n    case \"GET\":\n      await fetchUserCart(req, res);\n      break;\n\n    case \"PUT\":\n      await addProduct(req, res);\n      break;\n\n    case \"DELETE\":\n      await DeleteProduct(req, res);\n      break;\n  }\n});\nconst DeleteProduct = Authenticated(async (req, res) => {\n  const id = req.body.productId;\n  const cart = await Cart.findOneAndUpdate({\n    user: req.userid\n  }, {\n    $pull: {\n      products: {\n        product: id\n      }\n    }\n  }, {\n    new: true\n  }).populate(\"products.product\");\n  res.status(200).json(cart.products);\n});\nconst fetchUserCart = Authenticated(async (req, res) => {\n  const cart = await Cart.findOne({\n    user: req.userid\n  }).populate(\"products.product\");\n  res.status(200).json(cart.products);\n});\nconst addProduct = Authenticated(async (req, res) => {\n  const {\n    quantity,\n    productId\n  } = req.body;\n  const cart = await Cart.findOne({\n    user: req.userid\n  });\n  const pExist = cart.products.some(pdoc => productId === pdoc.product.toString());\n\n  if (pExist) {\n    await Cart.findOneAndUpdate({\n      _id: cart._id,\n      \"products.product\": productId\n    }, {\n      $inc: {\n        \"products.$.quantity\": quantity\n      }\n    });\n  } else {\n    const newProduct = {\n      quantity: quantity,\n      product: productId\n    };\n    await Cart.findOneAndUpdate({\n      _id: cart._id\n    }, {\n      $push: {\n        products: newProduct\n      }\n    });\n  }\n\n  res.status(200).json({\n    message: \"product added to cart\"\n  });\n});","map":null,"metadata":{},"sourceType":"module"}