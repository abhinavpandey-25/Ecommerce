{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport baseURL from '../helper/baseURL';\nimport { parseCookies } from 'nookies';\nimport cookie from 'js-cookie';\nimport { useRouter } from 'next/router';\nimport Link from 'next/link';\nimport { useState } from 'react';\nimport StripeCheckout from 'react-stripe-checkout';\n\nvar cart = function cart(_ref) {\n  var error = _ref.error,\n      products = _ref.products;\n  var router = useRouter();\n\n  var _parseCookies = parseCookies(),\n      token = _parseCookies.token;\n\n  var _useState = useState(products),\n      newCart = _useState[0],\n      setCart = _useState[1];\n\n  var price = 0;\n\n  if (!token) {\n    return /*#__PURE__*/_jsxs(\"div\", {\n      className: \"center-align\",\n      children: [/*#__PURE__*/_jsx(\"h3\", {\n        children: \"Please Login to view your cart\"\n      }), /*#__PURE__*/_jsx(Link, {\n        href: \"/login\",\n        children: /*#__PURE__*/_jsx(\"button\", {\n          className: \"btn\",\n          children: \"Login\"\n        })\n      })]\n    });\n  }\n\n  var handleRemove = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(pid) {\n      var res, res2;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return fetch(\"\".concat(baseURL, \"/api/cart\"), {\n                method: \"DELETE\",\n                headers: {\n                  \"Content-Type\": \"application/json\",\n                  \"Authorization\": token\n                },\n                body: JSON.stringify({\n                  productId: pid\n                })\n              });\n\n            case 2:\n              res = _context.sent;\n              _context.next = 5;\n              return res.json();\n\n            case 5:\n              res2 = _context.sent;\n              console.log(\"deleted\");\n              console.log(res2);\n              setCart(res2);\n              router.push('/');\n\n            case 10:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function handleRemove(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var CartItems = function CartItems() {\n    return /*#__PURE__*/_jsx(\"div\", {\n      children: newCart.map(function (items) {\n        price = price + items.quantity * items.product.price;\n        return /*#__PURE__*/_jsxs(\"div\", {\n          className: \"CartImages \",\n          children: [/*#__PURE__*/_jsx(\"img\", {\n            src: items.product.mediaURL\n          }), /*#__PURE__*/_jsxs(\"div\", {\n            style: {\n              margin: \"10px\"\n            },\n            children: [/*#__PURE__*/_jsxs(\"h3\", {\n              children: [items.product.name, \" \"]\n            }), /*#__PURE__*/_jsxs(\"h4\", {\n              children: [\"Quantity : \", items.quantity, \" \"]\n            }), /*#__PURE__*/_jsxs(\"h4\", {\n              children: [\"Price : \", items.product.price, \" \"]\n            }), /*#__PURE__*/_jsx(\"button\", {\n              className: \"btn #ff6f00 amber darken-4\",\n              onClick: function onClick() {\n                handleRemove(items.product._id);\n              },\n              children: \"REMOVE\"\n            })]\n          })]\n        }, items._id);\n      })\n    });\n  };\n\n  if (error) {\n    M.toast({\n      html: error,\n      classes: \"red\"\n    });\n    cookie.remove(\"user\");\n    cookie.remove(\"token\");\n    router.push('/login');\n  }\n\n  var handleCheckout = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(paymentInfo) {\n      var res, res2;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return fetch(\"\".concat(baseURL, \"/api/payment\"), {\n                method: \"POST\",\n                headers: {\n                  \"Content-Type\": 'application/json',\n                  \"Authorization\": token\n                },\n                body: JSON.stringify({\n                  paymentInfo: paymentInfo\n                })\n              });\n\n            case 2:\n              res = _context2.sent;\n              _context2.next = 5;\n              return res.json();\n\n            case 5:\n              res2 = _context2.sent;\n              M.toast({\n                html: res2.message,\n                classes: \"green\"\n              });\n              router.push(\"/\"); // console.log(res2);\n\n            case 8:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function handleCheckout(_x2) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var TotalPrice = function TotalPrice() {\n    return /*#__PURE__*/_jsxs(\"div\", {\n      className: \"container\",\n      style: {\n        display: \"flex\",\n        justifyContent: \"space-around\"\n      },\n      children: [/*#__PURE__*/_jsxs(\"h5\", {\n        children: [\" Total Price : \\u20B9 \", price]\n      }), /*#__PURE__*/_jsx(StripeCheckout, {\n        name: \"MyStore\",\n        amount: price * 100,\n        image: products.length > 0 ? products[0].product.mediaURL : \"\",\n        currency: \"INR\",\n        shippingAddress: true,\n        zipCode: true,\n        billingAddress: true,\n        stripeKey: \"pk_test_51Hy0XdFCPaJSpKjHAlxmpDRUSYSVFLDBaNdbr75P4HH7ZGxfMT1swPb183nadzpZvZsGi5qj3j71MsjvWVwCIZjx00R8zBNaWq\",\n        token: function token(paymentInfo) {\n          return handleCheckout(paymentInfo);\n        },\n        children: /*#__PURE__*/_jsx(\"button\", {\n          className: \"btn\",\n          children: \"Checkout\"\n        })\n      })]\n    });\n  };\n\n  if (products.length === 0) {\n    return /*#__PURE__*/_jsxs(\"div\", {\n      className: \"center-align\",\n      children: [\" \", /*#__PURE__*/_jsx(\"h2\", {\n        children: \"Your Cart Is Empty\"\n      }), /*#__PURE__*/_jsx(\"button\", {\n        className: \"btn\",\n        onClick: function onClick() {\n          router.push(\"/\");\n        },\n        children: \"Add Items in your cart \"\n      })]\n    });\n  }\n\n  return /*#__PURE__*/_jsxs(\"div\", {\n    className: \"container\",\n    children: [/*#__PURE__*/_jsx(CartItems, {}), /*#__PURE__*/_jsx(TotalPrice, {})]\n  });\n};\n\nexport var __N_SSP = true;\nexport default cart;","map":null,"metadata":{},"sourceType":"module"}