{"ast":null,"code":"import { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { useState } from 'react';\nimport baseUrl from '../helper/baseURL';\nimport { parseCookies } from 'nookies';\nimport { useRouter } from 'next/router';\n\nconst create = () => {\n  const router = useRouter(); //this create page should be accesed by onlly the admin as user cannnort add the items in the website\n\n  const {\n    0: name,\n    1: setName\n  } = useState(\"\");\n  const {\n    0: price,\n    1: setPrice\n  } = useState(\"\");\n  const {\n    0: media,\n    1: setMedia\n  } = useState(\"\");\n  const {\n    0: description,\n    1: setDescription\n  } = useState(\"\");\n\n  const handleSubmit = async e => {\n    e.preventDefault();\n    console.log(\"submit\");\n    const location = await fileUpload();\n    const res = await fetch(`${baseUrl}/api/products`, {\n      method: \"POST\" //hame header bhi specify krna padega ki frontend se kis type ka data bheja jyga from the frontend\\\n      ,\n      headers: {\n        'Content-Type': 'application/json' //server apne aap isko dekh k toh sari incoming request ko json m parse kr dega\n\n      },\n      //when sending the data to the server the data has to be a string\n      //whne receving data from a wev server the data is always a string then parse the data to become a js obj\n      body: JSON.stringify({\n        name: name,\n        price: price,\n        media: location,\n        //for storing image ham image phele upload krenge on cloudinary and then woh url save krenge and use access krenge\n        description: description\n      })\n    });\n    const res2 = await res.json();\n\n    if (res2.error) {\n      M.toast({\n        html: res2.error,\n        classes: \"red\"\n      });\n    } else {\n      M.toast({\n        html: \"Info saved successfully\",\n        classes: \"green\"\n      });\n    }\n\n    router.push('/');\n  };\n\n  const fileUpload = async () => {\n    const formData = new FormData();\n    formData.append('file', media);\n    formData.append('upload_preset', 'mystore2');\n    formData.append('cloud_name', 'storagearea');\n    const res = await fetch('https://api.cloudinary.com/v1_1/storagearea/image/upload', {\n      method: \"POST\",\n      body: formData\n    });\n    const res2 = await res.json();\n    return res2.url;\n  };\n\n  return /*#__PURE__*/_jsxs(\"form\", {\n    className: \"container\",\n    onSubmit: e => handleSubmit(e),\n    children: [/*#__PURE__*/_jsx(\"input\", {\n      type: \"text\",\n      placeholder: \"Enter Name\",\n      value: name,\n      onChange: e => {\n        // console.log(e.target.value);    \n        setName(() => e.target.value);\n      }\n    }), /*#__PURE__*/_jsx(\"input\", {\n      type: \"text\",\n      value: price,\n      placeholder: \"Enter Price\",\n      onChange: e => {\n        setPrice(() => e.target.value);\n      }\n    }), /*#__PURE__*/_jsxs(\"div\", {\n      className: \"file-field input-field\",\n      children: [/*#__PURE__*/_jsxs(\"div\", {\n        className: \"btn\",\n        children: [/*#__PURE__*/_jsx(\"span\", {\n          children: \"File\"\n        }), /*#__PURE__*/_jsx(\"input\", {\n          type: \"file\",\n          placeholder: \"Choose\",\n          onChange: e => {\n            setMedia(() => e.target.files[0]);\n          }\n        })]\n      }), /*#__PURE__*/_jsx(\"img\", {\n        className: \"responsive-img \",\n        src: media ? URL.createObjectURL(media) : \"\"\n      })]\n    }), /*#__PURE__*/_jsx(\"textarea\", {\n      value: description,\n      placeholder: \"add some description\",\n      className: \"materialize-textarea\",\n      onChange: e => setDescription(() => e.target.value)\n    }), /*#__PURE__*/_jsxs(\"button\", {\n      type: \"submit\",\n      className: \"waves-effect waves-light btn\",\n      children: [/*#__PURE__*/_jsx(\"i\", {\n        className: \"material-icons left\",\n        children: \"send\"\n      }), \"Submit\"]\n    })]\n  });\n}; //ctx me server se jo bhi a rha tha jese ham ne server se token and user in which i passed user role user email and user\n//user password  and ye data server p stringify m tha so we nned to parse the object to json\n\n\nexport async function getServerSideProps(ctx) {\n  const cookie = parseCookies(ctx);\n  const user = cookie.user ? JSON.parse(cookie.user) : \"\";\n\n  if (user.role != \"root\" && user.role != \"admin\") {\n    const {\n      res\n    } = ctx; //the status code for redirect is 302\n\n    res.writeHead(302, {\n      Location: \"/\"\n    });\n    res.end();\n  } //parsecookies sari cookies return krta \n  //status code for redirecting 302\n\n\n  return {\n    props: {}\n  };\n}\nexport default create;","map":null,"metadata":{},"sourceType":"module"}